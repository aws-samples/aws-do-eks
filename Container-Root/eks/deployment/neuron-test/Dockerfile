FROM amazonlinux:2

LABEL description="Neuronx base container"

ENV PYTHONUNBUFFERED=TRUE
ENV PYTHONDONTWRITEBYTECODE=TRUE
ENV PATH="/opt/aws/neuron/bin:${PATH}"

ARG NEURONX_RUNTIME_LIB_VERSION=2.16.*
ARG NEURONX_COLLECTIVES_LIB_VERSION=2.16.*
ARG NEURONX_TOOLS_VERSION=2.13.*
ARG NEURONX_FRAMEWORK_VERSION=2.1.2.2.2.*
ARG NEURONX_TRANSFORMERS_VERSION=0.6.*
ARG NEURONX_CC_VERSION=2.9.*
ARG TORCHSERVE_VERSION=0.8.2

ARG http_proxy
ARG https_proxy
ARG no_proxy


ENV NEURONX_RUNTIME_LIB_VERSION=${NEURONX_RUNTIME_LIB_VERSION}
ENV NEURONX_COLLECTIVES_LIB_VERSION=${NEURONX_COLLECTIVES_LIB_VERSION}
ENV NEURONX_TOOLS_VERSION=${NEURONX_TOOLS_VERSION}
ENV NEURONX_FRAMEWORK_VERSION=${NEURONX_FRAMEWORK_VERSION}
ENV NEURONX_TRANSFORMERS_VERSION=${NEURONX_TRANSFORMERS_VERSION}
ENV NEURONX_CC_VERSION=${NEURONX_CC_VERSION}
ENV TORCHSERVE_VERSION=${TORCHSERVE_VERSION}

ADD Container-Root /

RUN export NEURONX_RUNTIME_LIB_VERSION=${NEURONX_RUNTIME_LIB_VERSION}; export NEURONX_COLLECTIVES_LIB_VESRION=${NEURONX_COLLECTIVES_LIB_VERSION}; export NEURONX_TOOLS_VERSION=${NEURONX_TOOLS_VERSION}; export NEURONX_FRAMEWORK_VERSION=${NEURONX_FRAMEWORK_VERSION}; export NEURONX_TRANSFORMERS_VERSION=${NEURONX_TRANSFORMERS_VERSION}; export NEURONX_CC_VERSION=${NEURONX_CC_VERSION}; export TORCHSERVE_VERSION=${TORCHSERVE_VERSION}; export http_proxy=$http_proxy; export https_proxy=$https_proxy; export no_proxy=$no_proxy; /setup.sh; rm -f /setup.sh

CMD /startup.sh

